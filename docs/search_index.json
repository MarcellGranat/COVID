[
["index.html", "A COVID járvány elemzése többváltozós statisztikai eszközökkel Mi ez a projekt?", " A COVID járvány elemzése többváltozós statisztikai eszközökkel Granát Marcell &amp; Mazzag Bálint Mi ez a projekt? A tanulmány a Budapesti Corvinus Egyetem Többváltozós adatelemzés tárgy keretében készült. Kézirat lezárásának dátuma: 2021. január 3. A kézirat tartalmához fűzödő tudományos diszkusszió támogatása érdekében egy párbeszéd ablak került megnyitásra az anyagokat tartalmazó GitHub repository oldalán: https://github.com/MarcellGranat/COVID/discussions p { text-align: justify; } .author { font-size: 20px; text-align: center; } .title { text-align: center; } "],
["Chapter-2.html", "Döntési fa és véletlen erdő Adatok bemutatása Modellbecslés Keresztvalidáció és véletlen erdő hiperparamétere", " Döntési fa és véletlen erdő p { text-align: justify; } Az egyik talán legfontosabb kérdés a járványügyben, hogy mennyire halálos a vírus. Már a megjelenésekor nagyon hamar ismertté vált a tény: elsősorban az idősekre és krónikus betegre jelent kockázatot. Ennek a ténynek empirikus teszteléséhez olyan adattáblára van szükségünk, melyben rögzítésre kerülnek a megfertőzöttek demográfiai adatai és az eset végső kimenete (ezt a fajta adattípust nevezik “line list”-nek). Adatok bemutatása Forrás A fentebb leírt célra lett létrehozva egy nyílt projekt1, amely során ezeket az adatokat több országra gyűjtik ki és teszi online elérhetővé. dat &lt;- vroom::vroom(&#39;latestdata.csv&#39;) Az adattábla összesen 2676311 megfigyelést tartalmaz 33 változóval. Azonban a változók jelentős része használhatatlan elemzésre és jelentős mértékben van szükség az adatok tisztítására is. Egyetlen példa említéseként a kimenetben nem egyszerűen died vagy elhunyt szerepelt, hanem annak számos szinonímája is, amelett, hogy sok esetben nincs elérhető adat. set.seed(1) dat %&gt;% count(outcome) %&gt;% na.omit() %&gt;% {mutate(., s = runif(n = nrow(.)))} %&gt;% ggplot(aes(label = outcome, size = s)) + geom_text_wordcloud(color = &#39;aquamarine4&#39;) + labs(title = &quot;Az nyers adattáblában a kimenet változó által felvett értékek&quot;) + theme_minimal() Adatok elemzéshez való előkészítése Az adatok megtiszítása előtt el kell döntenünk, hogy mely változókkal is érdemes foglalkozni, mivel sajnos számos változó esetében hiányzik rengeteg sor a táblában. dat %&gt;% apply(2, function(x) sum(is.na(x))) %&gt;% {data.frame(var = names(.), nobs = nrow(dat)-., robs = (nrow(dat)-.)/nrow(dat))} %&gt;% set_names(&#39;var&#39;, &#39;Hiánytalan adatok száma&#39;, &#39;Hiánytalanok aránya&#39;) %&gt;% gt( rowname_col = &quot;var&quot; ) %&gt;% fmt_percent( columns = vars(&#39;Hiánytalanok aránya&#39;), dec_mark = &#39;,&#39; ) %&gt;% tab_header(title = &#39;Adattáblában lévő hiánytalan megfigyelések aránya&#39;) html { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif; } #pamufqigws .gt_table { display: table; border-collapse: collapse; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; } #pamufqigws .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; } #pamufqigws .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; border-bottom-color: #FFFFFF; border-bottom-width: 0; } #pamufqigws .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 0; padding-bottom: 4px; border-top-color: #FFFFFF; border-top-width: 0; } #pamufqigws .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; } #pamufqigws .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; } #pamufqigws .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; } #pamufqigws .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; } #pamufqigws .gt_column_spanner_outer:first-child { padding-left: 0; } #pamufqigws .gt_column_spanner_outer:last-child { padding-right: 0; } #pamufqigws .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; overflow-x: hidden; display: inline-block; width: 100%; } #pamufqigws .gt_group_heading { padding: 8px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; } #pamufqigws .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: middle; } #pamufqigws .gt_from_md > :first-child { margin-top: 0; } #pamufqigws .gt_from_md > :last-child { margin-bottom: 0; } #pamufqigws .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; } #pamufqigws .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 12px; } #pamufqigws .gt_summary_row { color: #333333; background-color: #FFFFFF; text-transform: inherit; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; } #pamufqigws .gt_first_summary_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; } #pamufqigws .gt_grand_summary_row { color: #333333; background-color: #FFFFFF; text-transform: inherit; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; } #pamufqigws .gt_first_grand_summary_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; border-top-style: double; border-top-width: 6px; border-top-color: #D3D3D3; } #pamufqigws .gt_striped { background-color: rgba(128, 128, 128, 0.05); } #pamufqigws .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; } #pamufqigws .gt_footnotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; } #pamufqigws .gt_footnote { margin: 0px; font-size: 90%; padding: 4px; } #pamufqigws .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; } #pamufqigws .gt_sourcenote { font-size: 90%; padding: 4px; } #pamufqigws .gt_left { text-align: left; } #pamufqigws .gt_center { text-align: center; } #pamufqigws .gt_right { text-align: right; font-variant-numeric: tabular-nums; } #pamufqigws .gt_font_normal { font-weight: normal; } #pamufqigws .gt_font_bold { font-weight: bold; } #pamufqigws .gt_font_italic { font-style: italic; } #pamufqigws .gt_super { font-size: 65%; } #pamufqigws .gt_footnote_marks { font-style: italic; font-size: 65%; } Adattáblában lévő hiánytalan megfigyelések aránya Hiánytalan adatok száma Hiánytalanok aránya ID 2676311 100,00&percnt; age 578018 21,60&percnt; sex 580157 21,68&percnt; city 1698630 63,47&percnt; province 2223647 83,09&percnt; country 2676196 100,00&percnt; latitude 2676250 100,00&percnt; longitude 2676250 100,00&percnt; geo_resolution 2676250 100,00&percnt; date_onset_symptoms 261599 9,77&percnt; date_admission_hospital 116211 4,34&percnt; date_confirmation 2567822 95,95&percnt; symptoms 0 0,00&percnt; lives_in_Wuhan 0 0,00&percnt; travel_history_dates 2611 0,10&percnt; travel_history_location 9222 0,34&percnt; reported_market_exposure 0 0,00&percnt; additional_information 45855 1,71&percnt; chronic_disease_binary 2676311 100,00&percnt; chronic_disease 0 0,00&percnt; source 2109347 78,82&percnt; sequence_available 0 0,00&percnt; outcome 307382 11,49&percnt; date_death_or_discharge 0 0,00&percnt; notes_for_discussion 0 0,00&percnt; location 13376 0,50&percnt; admin3 80434 3,01&percnt; admin2 826054 30,87&percnt; admin1 1257558 46,99&percnt; country_new 2645758 98,86&percnt; admin_id 2676250 100,00&percnt; data_moderator_initials 1742983 65,13&percnt; travel_history_binary 2610732 97,55&percnt; Az adatok hiányosságának és felhasználhatóságának figyelembevételével az alábbi változókat érdemes bevonni a modellbe: - életkor - nem - ország - van-e krónikus betegsége - fertőződöttség kimutatásának ideje - földrajzi szélesség - földrajzi hosszúság - megbetegedés kimenete A változók tisztítása során egyik legfontosabb, hogy a kimenet oszlopban összevontuk minden elhalálozásra megfelelő szinonímát egységesen az elhunyt kategóriába, és minden felépültnek megfelelőt a felépültbe. Mivel jelen elemzés kutatási kérdése, hogy mi a valószínűsége, hogy valaki túléli, így elvetettünk minden megfigyelést, amely esetében az alany még betegség alatt áll, vagy a kimenet ismeretlen. Az ország oszlopból kontinensként új magyarázó változót határoztunk meg, és az évek esetében ismeretlennek vetük azokat, ahol intervallum került megadásra2. dat %&gt;% select(outcome, age, sex, country, chronic_disease_binary, latitude, longitude, date_confirmation) %&gt;% mutate( continent = countrycode::countrycode(country, origin = &#39;country.name&#39;, destination = &#39;continent&#39;), date = as.numeric(difftime(time1 = lubridate::dmy(date_confirmation), time2 = lubridate::dmy(&quot;01/01/2020&quot;), units = &#39;days&#39;)), age = as.numeric(ifelse(str_detect(age, &#39;-&#39;), NA, age)) ) %&gt;% mutate( # cleaning the depedent var outcome = case_when( outcome == &#39;death&#39; ~ &#39;died&#39;, outcome == &#39;died&#39; ~ &#39;died&#39;, outcome == &#39;Death&#39; ~ &#39;died&#39;, outcome == &#39;dead&#39; ~ &#39;died&#39;, outcome == &#39;Dead&#39; ~ &#39;died&#39;, outcome == &#39;Died&#39; ~ &#39;died&#39;, outcome == &#39;Deceased&#39; ~ &#39;died&#39;, outcome == &#39;discharge&#39; ~ &#39;survived&#39;, outcome == &#39;discharged&#39; ~ &#39;survived&#39;, outcome == &#39;Discharged&#39; ~ &#39;survived&#39;, outcome == &#39;Discharged from hospital&#39; ~ &#39;survived&#39;, outcome == &#39;recovered&#39; ~ &#39;survived&#39;, outcome == &#39;released from quarantine&#39; ~ &#39;survived&#39;, outcome == &#39;recovered&#39; ~ &#39;survived&#39;, outcome == &#39;Recovered&#39; ~ &#39;survived&#39;, outcome == &#39;Recovered&#39; ~ &#39;survived&#39;, outcome == &#39;Recovered&#39; ~ &#39;survived&#39;, T ~ &#39;NA&#39; ) ) %&gt;% filter(outcome != &#39;NA&#39;) %&gt;% mutate( died = outcome == &#39;died&#39; ) %&gt;% select(-outcome, -date_confirmation) %&gt;% {dat &lt;&lt;- .} Az így kapott új adattáblában már csupán 103616 megfigyelés és 9 változó szerepel. dat %&gt;% head %&gt;% gt %&gt;% tab_header(title = &#39;Adattábla modellezésre előkészítve&#39;) html { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif; } #vrzpkjgsbj .gt_table { display: table; border-collapse: collapse; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; } #vrzpkjgsbj .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; } #vrzpkjgsbj .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; border-bottom-color: #FFFFFF; border-bottom-width: 0; } #vrzpkjgsbj .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 0; padding-bottom: 4px; border-top-color: #FFFFFF; border-top-width: 0; } #vrzpkjgsbj .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; } #vrzpkjgsbj .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; } #vrzpkjgsbj .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; } #vrzpkjgsbj .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; } #vrzpkjgsbj .gt_column_spanner_outer:first-child { padding-left: 0; } #vrzpkjgsbj .gt_column_spanner_outer:last-child { padding-right: 0; } #vrzpkjgsbj .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; overflow-x: hidden; display: inline-block; width: 100%; } #vrzpkjgsbj .gt_group_heading { padding: 8px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; } #vrzpkjgsbj .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: middle; } #vrzpkjgsbj .gt_from_md > :first-child { margin-top: 0; } #vrzpkjgsbj .gt_from_md > :last-child { margin-bottom: 0; } #vrzpkjgsbj .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; } #vrzpkjgsbj .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 12px; } #vrzpkjgsbj .gt_summary_row { color: #333333; background-color: #FFFFFF; text-transform: inherit; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; } #vrzpkjgsbj .gt_first_summary_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; } #vrzpkjgsbj .gt_grand_summary_row { color: #333333; background-color: #FFFFFF; text-transform: inherit; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; } #vrzpkjgsbj .gt_first_grand_summary_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; border-top-style: double; border-top-width: 6px; border-top-color: #D3D3D3; } #vrzpkjgsbj .gt_striped { background-color: rgba(128, 128, 128, 0.05); } #vrzpkjgsbj .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; } #vrzpkjgsbj .gt_footnotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; } #vrzpkjgsbj .gt_footnote { margin: 0px; font-size: 90%; padding: 4px; } #vrzpkjgsbj .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; } #vrzpkjgsbj .gt_sourcenote { font-size: 90%; padding: 4px; } #vrzpkjgsbj .gt_left { text-align: left; } #vrzpkjgsbj .gt_center { text-align: center; } #vrzpkjgsbj .gt_right { text-align: right; font-variant-numeric: tabular-nums; } #vrzpkjgsbj .gt_font_normal { font-weight: normal; } #vrzpkjgsbj .gt_font_bold { font-weight: bold; } #vrzpkjgsbj .gt_font_italic { font-style: italic; } #vrzpkjgsbj .gt_super { font-size: 65%; } #vrzpkjgsbj .gt_footnote_marks { font-style: italic; font-size: 65%; } Adattábla modellezésre előkészítve age sex country chronic_disease_binary latitude longitude continent date died 78 male Italy FALSE 45.297748 11.65838 Europe 51 TRUE 61 female Singapore FALSE 1.353460 103.81510 Asia 44 FALSE 28 male Singapore FALSE 1.353460 103.81510 Asia 44 FALSE 56 female Singapore FALSE 1.353460 103.81510 Asia 44 FALSE 79 female Singapore FALSE 1.353873 103.86048 Asia 44 FALSE 26 male Singapore FALSE 1.353460 103.81510 Asia 45 FALSE dat %&gt;% select(age, sex, died) %&gt;% GGally::ggpairs(mapping = aes(color = died), title = &#39;Életkor, nem és az elhalálozás kapcsolata&#39;) dat %&gt;% select(continent, date, died) %&gt;% GGally::ggpairs(aes(color = died), title = &#39;A kontinens a rögzítés dátuma és az elhalálozás kapcsolata&#39;) Az ábrákból sajnos gyorsan kiderül, hogy a kimeneti adatra való rászűrést követően az adattáblában már jórészt csak ázsiai országok képviseltetik magukat. Más kontintensekről származó adatok esetében ez az oszlop nem került megfelelően dokumentálásra. dat %&gt;% group_by(continent, country) %&gt;% summarise(n = n()) %&gt;% ungroup() %&gt;% na.omit() %&gt;% mutate( r = n/nrow(dat) ) %&gt;% arrange(continent) %&gt;% set_names(&#39;continent&#39;, &#39;country&#39;, &#39;n&#39;, &#39;n/sum(n)&#39;) %&gt;% gt( rowname_col = &#39;country&#39;, groupname_col = &#39;continent&#39; ) %&gt;% fmt_percent( columns = &#39;n/sum(n)&#39;, ) %&gt;% summary_rows(groups = T, columns = vars(n), fns = list(TOTAL = &#39;sum&#39;)) %&gt;% summary_rows(groups = T, columns = vars(&#39;n/sum(n)&#39;), fns = list(TOTAL = &#39;sum&#39;), formatter = fmt_percent) %&gt;% tab_options( summary_row.background.color = &quot;#ACEACE&quot;, row_group.background.color = &quot;#FFEFDB&quot; ) %&gt;% tab_header(title = &#39;Megfigyelések száma országonként&#39;, subtitle = &#39;Elsődleges adattisztítás után&#39;) html { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif; } #akzozxjpul .gt_table { display: table; border-collapse: collapse; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; } #akzozxjpul .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; } #akzozxjpul .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; border-bottom-color: #FFFFFF; border-bottom-width: 0; } #akzozxjpul .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 0; padding-bottom: 4px; border-top-color: #FFFFFF; border-top-width: 0; } #akzozxjpul .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; } #akzozxjpul .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; } #akzozxjpul .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; } #akzozxjpul .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; } #akzozxjpul .gt_column_spanner_outer:first-child { padding-left: 0; } #akzozxjpul .gt_column_spanner_outer:last-child { padding-right: 0; } #akzozxjpul .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; overflow-x: hidden; display: inline-block; width: 100%; } #akzozxjpul .gt_group_heading { padding: 8px; color: #333333; background-color: #FFEFDB; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; } #akzozxjpul .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFEFDB; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: middle; } #akzozxjpul .gt_from_md > :first-child { margin-top: 0; } #akzozxjpul .gt_from_md > :last-child { margin-bottom: 0; } #akzozxjpul .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; } #akzozxjpul .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 12px; } #akzozxjpul .gt_summary_row { color: #333333; background-color: #ACEACE; text-transform: inherit; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; } #akzozxjpul .gt_first_summary_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; } #akzozxjpul .gt_grand_summary_row { color: #333333; background-color: #FFFFFF; text-transform: inherit; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; } #akzozxjpul .gt_first_grand_summary_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; border-top-style: double; border-top-width: 6px; border-top-color: #D3D3D3; } #akzozxjpul .gt_striped { background-color: rgba(128, 128, 128, 0.05); } #akzozxjpul .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; } #akzozxjpul .gt_footnotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; } #akzozxjpul .gt_footnote { margin: 0px; font-size: 90%; padding: 4px; } #akzozxjpul .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; } #akzozxjpul .gt_sourcenote { font-size: 90%; padding: 4px; } #akzozxjpul .gt_left { text-align: left; } #akzozxjpul .gt_center { text-align: center; } #akzozxjpul .gt_right { text-align: right; font-variant-numeric: tabular-nums; } #akzozxjpul .gt_font_normal { font-weight: normal; } #akzozxjpul .gt_font_bold { font-weight: bold; } #akzozxjpul .gt_font_italic { font-style: italic; } #akzozxjpul .gt_super { font-size: 65%; } #akzozxjpul .gt_footnote_marks { font-style: italic; font-size: 65%; } Megfigyelések száma országonként Elsődleges adattisztítás után n n/sum(n) Africa Algeria 9 0.01&percnt; Burkina Faso 3 0.00&percnt; Cabo Verde 1 0.00&percnt; Cameroon 1 0.00&percnt; Egypt 2 0.00&percnt; Eswatini 1 0.00&percnt; Ethiopia 1 0.00&percnt; Gabon 1 0.00&percnt; Gambia 5 0.00&percnt; Ghana 7 0.01&percnt; Niger 1 0.00&percnt; Nigeria 1 0.00&percnt; Sudan 1 0.00&percnt; Tanzania 1 0.00&percnt; Togo 2 0.00&percnt; Zimbabwe 5 0.00&percnt; TOTAL 42.00 0.04&percnt; Americas Bahamas 1 0.00&percnt; Brazil 4 0.00&percnt; Canada 6 0.01&percnt; Cuba 1 0.00&percnt; Guyana 2 0.00&percnt; United States 48 0.05&percnt; TOTAL 62.00 0.06&percnt; Asia China 105 0.10&percnt; India 98645 95.20&percnt; Iran 4 0.00&percnt; Japan 8 0.01&percnt; Malaysia 6 0.01&percnt; Nepal 2 0.00&percnt; Philippines 4505 4.35&percnt; Singapore 118 0.11&percnt; South Korea 26 0.03&percnt; Thailand 2 0.00&percnt; United Arab Emirates 2 0.00&percnt; Vietnam 32 0.03&percnt; TOTAL 103,455.00 99.84&percnt; Europe France 7 0.01&percnt; Germany 3 0.00&percnt; Italy 7 0.01&percnt; Romania 8 0.01&percnt; San Marino 1 0.00&percnt; Spain 2 0.00&percnt; Switzerland 3 0.00&percnt; TOTAL 31.00 0.03&percnt; Oceania Australia 24 0.02&percnt; TOTAL 24.00 0.02&percnt; A táblázatból jól látható, hogy a legtöbb felhasználható megfigyelésünk Indiából származik. Logikusnak tűnik egy dummy változót létrehozni ezért Indiára (india = {TRUE, ha Indiából származik, FALSE egyébként}). Indiára való kontrolálás elméleti megfontolásból is helyesnek hangzik, figyelembe véve, hogy az ország rendkívül szegény, a városok zsúfoltak, orvosokból és felszerelésből, pedig hiány van. Korábban a spanyol nátha idején is kiugróan magas volt Indiában a halálozás3. dat %&gt;% mutate( india = country == &#39;India&#39; ) %&gt;% select(-country, -continent, -latitude, -longitude) %&gt;% {dat &lt;&lt;- .} dat %&gt;% head() %&gt;% gt %&gt;% tab_header(title = &#39;Végső adattábla modellezéshez&#39;) html { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif; } #gxuvhaszck .gt_table { display: table; border-collapse: collapse; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; } #gxuvhaszck .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; } #gxuvhaszck .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; border-bottom-color: #FFFFFF; border-bottom-width: 0; } #gxuvhaszck .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 0; padding-bottom: 4px; border-top-color: #FFFFFF; border-top-width: 0; } #gxuvhaszck .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; } #gxuvhaszck .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; } #gxuvhaszck .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; } #gxuvhaszck .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; } #gxuvhaszck .gt_column_spanner_outer:first-child { padding-left: 0; } #gxuvhaszck .gt_column_spanner_outer:last-child { padding-right: 0; } #gxuvhaszck .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; overflow-x: hidden; display: inline-block; width: 100%; } #gxuvhaszck .gt_group_heading { padding: 8px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; } #gxuvhaszck .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: middle; } #gxuvhaszck .gt_from_md > :first-child { margin-top: 0; } #gxuvhaszck .gt_from_md > :last-child { margin-bottom: 0; } #gxuvhaszck .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; } #gxuvhaszck .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 12px; } #gxuvhaszck .gt_summary_row { color: #333333; background-color: #FFFFFF; text-transform: inherit; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; } #gxuvhaszck .gt_first_summary_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; } #gxuvhaszck .gt_grand_summary_row { color: #333333; background-color: #FFFFFF; text-transform: inherit; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; } #gxuvhaszck .gt_first_grand_summary_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; border-top-style: double; border-top-width: 6px; border-top-color: #D3D3D3; } #gxuvhaszck .gt_striped { background-color: rgba(128, 128, 128, 0.05); } #gxuvhaszck .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; } #gxuvhaszck .gt_footnotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; } #gxuvhaszck .gt_footnote { margin: 0px; font-size: 90%; padding: 4px; } #gxuvhaszck .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; } #gxuvhaszck .gt_sourcenote { font-size: 90%; padding: 4px; } #gxuvhaszck .gt_left { text-align: left; } #gxuvhaszck .gt_center { text-align: center; } #gxuvhaszck .gt_right { text-align: right; font-variant-numeric: tabular-nums; } #gxuvhaszck .gt_font_normal { font-weight: normal; } #gxuvhaszck .gt_font_bold { font-weight: bold; } #gxuvhaszck .gt_font_italic { font-style: italic; } #gxuvhaszck .gt_super { font-size: 65%; } #gxuvhaszck .gt_footnote_marks { font-style: italic; font-size: 65%; } Végső adattábla modellezéshez age sex chronic_disease_binary date died india 78 male FALSE 51 TRUE FALSE 61 female FALSE 44 FALSE FALSE 28 male FALSE 44 FALSE FALSE 56 female FALSE 44 FALSE FALSE 79 female FALSE 44 FALSE FALSE 26 male FALSE 45 FALSE FALSE Modellbecslés rpart2 &lt;- rpart::rpart(dat, formula = as.factor(died) ~ ., cp = .003) rattle::fancyRpartPlot(rpart2, palettes = &#39;OrRd&#39;, # plot sub = &#39;cp = .003&#39;, main = &#39;2. döntési fa&#39;) A döntési fa alapján még mindig az életkor a legfontosabb paraméter, ugyanakkor láthatjuk, hogy a földrajzi elhelyezkedés és a krónikus betegség is megjelenik, mint faktor. Keresztvalidáció és véletlen erdő hiperparamétere library(caret) keresztval &lt;- trainControl(method=&quot;cv&quot;, number=10) ism_keresztval &lt;- trainControl(method=&quot;repeatedcv&quot;, number=10, repeats=20) cp &lt;- data.frame(cp=seq(from=0, by=0.004, to=0.1)) train(as.factor(died)~., data=na.omit(dat), method=&quot;rpart&quot;, trControl=keresztval) CART 5324 samples 5 predictor 2 classes: &#39;FALSE&#39;, &#39;TRUE&#39; No pre-processing Resampling: Cross-Validated (10 fold) Summary of sample sizes: 4791, 4791, 4792, 4792, 4791, 4792, ... Resampling results across tuning parameters: cp Accuracy Kappa 0.06853583 0.8005368 0.3278424 0.07320872 0.7924540 0.3314484 0.08255452 0.7791212 0.1671317 Accuracy was used to select the optimal model using the largest value. The final value used for the model was cp = 0.06853583. train(as.factor(died)~., data=na.omit(dat), method=&quot;rpart&quot;, trControl=ism_keresztval) CART 5324 samples 5 predictor 2 classes: &#39;FALSE&#39;, &#39;TRUE&#39; No pre-processing Resampling: Cross-Validated (10 fold, repeated 20 times) Summary of sample sizes: 4792, 4792, 4792, 4791, 4791, 4792, ... Resampling results across tuning parameters: cp Accuracy Kappa 0.06853583 0.8016524 0.3359104 0.07320872 0.7924109 0.3201133 0.08255452 0.7815535 0.2639696 Accuracy was used to select the optimal model using the largest value. The final value used for the model was cp = 0.06853583. trained_hyperparam &lt;- as.double(train(as.factor(died)~., data=na.omit(dat), method=&quot;rpart&quot;, trControl=ism_keresztval)$bestTune[&quot;cp&quot;]) train(as.factor(died)~., data=na.omit(dat), method=&quot;rpart&quot;, trControl=keresztval, tuneGrid=cp) CART 5324 samples 5 predictor 2 classes: &#39;FALSE&#39;, &#39;TRUE&#39; No pre-processing Resampling: Cross-Validated (10 fold) Summary of sample sizes: 4792, 4791, 4792, 4792, 4791, 4792, ... Resampling results across tuning parameters: cp Accuracy Kappa 0.000 0.8296467 0.50239598 0.004 0.8424128 0.52194736 0.008 0.8420368 0.52900038 0.012 0.8416609 0.52534371 0.016 0.8433526 0.52698724 0.020 0.8390293 0.50876580 0.024 0.8369634 0.50014462 0.028 0.8358377 0.49367531 0.032 0.8315137 0.47355055 0.036 0.8283221 0.45806597 0.040 0.8283221 0.45806597 0.044 0.8283221 0.45806597 0.048 0.8283221 0.45806597 0.052 0.8241945 0.43920803 0.056 0.8183734 0.41198356 0.060 0.8146140 0.39475334 0.064 0.8080474 0.39492841 0.068 0.8080474 0.39492841 0.072 0.7994114 0.35021917 0.076 0.7845650 0.30406236 0.080 0.7838131 0.29324780 0.084 0.7821213 0.25006296 0.088 0.7811815 0.20997506 0.092 0.7811815 0.20997506 0.096 0.7759166 0.10352742 0.100 0.7659644 0.04396933 Accuracy was used to select the optimal model using the largest value. The final value used for the model was cp = 0.016. A keresztvalidáció alapján a véletlen erdő hiperparaméterét kalibráljuk. Mind a sima, mind az ismétléses módszerrel nagyjából 0.0685358 a kalibrációs paraméter értéke. library(randomForest) erdo &lt;- randomForest(as.factor(died)~., data=na.omit(dat), ntree=1000, cp = .0069) Error in randomForest.default(m, y, ...): NA/NaN/Inf in foreign function call (arg 1) plot(erdo) Error in plot(erdo): object &#39;erdo&#39; not found varImpPlot(erdo) Error in varImpPlot(erdo): object &#39;erdo&#39; not found A modell hibája nagyjából 200 fa után stabilizálódik, így az 1000 ismétlést éreztük helyénvalónak. Ez alapján pedig a legfontosabb paraméter az év, azonban a korábbi döntési fán nem megtalálható dátum változó is fontos a kimenetel szempontjából. Error in predict(erdo, na.omit(dat), type = &quot;class&quot;): object &#39;erdo&#39; not found Error in table(na.omit(dat)$died, pred_forest): object &#39;pred_forest&#39; not found Accuracy Kappa 0.8243802 0.4179893 Error in confusionMatrix(pred_forest_table): object &#39;pred_forest_table&#39; not found Sensitivity Specificity 0.8302489 0.7800963 Error in confusionMatrix(pred_forest_table): object &#39;pred_forest_table&#39; not found A döntési fa és véletlen erdő összehasonlításakor mind a kappa, mind pedig a találati arány értékét összehasonlítva az erdő lenne a jobb modell. Open COVID-19 Data Working Group, Detailed Epidemiological Data from the COVID-19 Outbreak, http://virological.org/t/epidemiological-data-from-the-ncov-2019-outbreak-early-descriptions-from-publicly-available-data/337, letöltve: 2020.12.28.↩︎ Az intervallumok hossza nem egyezett meg.↩︎ https://www.economist.com/asia/2020/03/21/if-covid-19-takes-hold-in-india-the-toll-will-be-grim↩︎ "],
["Chapter-3.html", "Logit-modell Logit modell kalibrálása", " Logit-modell p { text-align: justify; } A logit-modell építése során az a legfontosabb feladatunk, hogy a megfertőződött egyének paraméterei alapján megbecsüljük a halálozásuk valószínűségét. Mint tapasztalhattuk, leginkább az idősebb korosztályt érintette súlyosabban a vírus, de az életkoron kívül felhasználjuk még az országokat, és a nemet is. A bemutatott adattábla torzítottsága miatt a modellünkben csak ázsiai országok adatait használjuk, így a kontinens változóját nem, csak az országokét használtuk. Logit modell kalibrálása Outlierek és VIF mutató szerinti elemzés Philippines India Singapore China Vietnam South Korea 4503 521 118 76 32 20 Malaysia Japan Nepal 6 4 2 Láthatjuk, hogy a legtöbb megfigyelést Fülöp-szigetek és India adja A változók tisztításának lépései: -először az alapmodellünk során kirajzolódott outliereket szűrjük ki -az országok közül India és a Fülöp-szigetek rendelkezik nagy VIF-mutatóval, így ezeket összevonjuk, ezzel eltüntetve a magas VIF-értékeket #Országok közül India és Fülöp-szigetek rendelkezik magas VIF-el logit &lt;- glm(died~age+sex+country+chronic_disease_binary, data=data_Asia, family=binomial(logit)) summary(logit) Call: glm(formula = died ~ age + sex + country + chronic_disease_binary, family = binomial(logit), data = data_Asia) Deviance Residuals: Min 1Q Median 3Q Max -3.1615 -0.5805 -0.3187 -0.0001 3.2810 Coefficients: Estimate Std. Error z value Pr(&gt;|z|) (Intercept) -3.849e+00 3.614e-01 -10.652 &lt; 2e-16 *** age 6.925e-02 2.634e-03 26.291 &lt; 2e-16 *** sexTRUE 3.587e-01 8.271e-02 4.337 1.44e-05 *** countryIndia 1.312e+00 3.504e-01 3.745 0.00018 *** countryJapan -1.654e+01 1.958e+03 -0.008 0.99326 countryMalaysia -1.717e+01 1.347e+03 -0.013 0.98983 countryNepal -1.629e+01 2.797e+03 -0.006 0.99535 countryPhilippines -1.529e+00 3.325e-01 -4.597 4.29e-06 *** countrySingapore -1.715e+01 3.343e+02 -0.051 0.95910 countrySouth Korea -1.643e+01 8.259e+02 -0.020 0.98413 countryThailand -1.761e+01 2.797e+03 -0.006 0.99498 countryVietnam -1.880e+01 5.651e+02 -0.033 0.97347 chronic_disease_binaryTRUE 2.331e+00 3.038e-01 7.674 1.67e-14 *** --- Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 (Dispersion parameter for binomial family taken to be 1) Null deviance: 5875.9 on 5283 degrees of freedom Residual deviance: 3889.3 on 5271 degrees of freedom AIC: 3915.3 Number of Fisher Scoring iterations: 16 vif(logit) age sexTRUE 1.064698 1.017816 countryIndia countryJapan 7.529853 1.056988 countryMalaysia countryNepal 1.084271 1.028635 countryPhilippines countrySingapore 9.458835 2.610870 countrySouth Korea countryThailand 1.280892 1.028172 countryVietnam chronic_disease_binaryTRUE 1.429719 1.104861 #Outlierek leszűrése data_Asia &lt;- data_Asia[abs(rstudent(logit))&lt;3, ] #Indiát és Fülöp-szigeteket összevonva csökken a VIF-mutató data_Asia$country_alt &lt;- data_Asia$country data_Asia[data_Asia$country_alt==&quot;India&quot;, &quot;country_alt&quot;] &lt;- &quot;Philippines&quot; logit2 &lt;- glm(died~age+sex+chronic_disease_binary+country_alt, data=data_Asia, family=binomial(logit)) summary(logit2) Call: glm(formula = died ~ age + sex + chronic_disease_binary + country_alt, family = binomial(logit), data = data_Asia) Deviance Residuals: Min 1Q Median 3Q Max -2.3211 -0.6536 -0.3621 -0.0001 3.2244 Coefficients: Estimate Std. Error z value Pr(&gt;|z|) (Intercept) -3.799e+00 3.607e-01 -10.531 &lt; 2e-16 *** age 7.146e-02 2.532e-03 28.224 &lt; 2e-16 *** sexTRUE 4.709e-01 7.723e-02 6.098 1.07e-09 *** chronic_disease_binaryTRUE 2.129e+00 3.218e-01 6.617 3.66e-11 *** country_altJapan -1.678e+01 1.954e+03 -0.009 0.993 country_altMalaysia -1.739e+01 1.298e+03 -0.013 0.989 country_altNepal -1.652e+01 2.797e+03 -0.006 0.995 country_altPhilippines -1.394e+00 3.358e-01 -4.152 3.30e-05 *** country_altSingapore -1.736e+01 3.304e+02 -0.053 0.958 country_altSouth Korea -1.664e+01 8.145e+02 -0.020 0.984 country_altThailand -1.788e+01 2.797e+03 -0.006 0.995 country_altVietnam -1.891e+01 5.621e+02 -0.034 0.973 --- Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 (Dispersion parameter for binomial family taken to be 1) Null deviance: 5835.2 on 5267 degrees of freedom Residual deviance: 4348.6 on 5256 degrees of freedom AIC: 4372.6 Number of Fisher Scoring iterations: 16 vif(logit2) age sexTRUE 1.047368 1.010986 chronic_disease_binaryTRUE country_altJapan 1.090713 1.057938 country_altMalaysia country_altNepal 1.085748 1.029110 country_altPhilippines country_altSingapore 3.546896 2.639480 country_altSouth Korea country_altThailand 1.285864 1.028649 country_altVietnam 1.438922 Nemlinearitás vizsgálata a RESET-teszttel A linearitás teszteléséhez felhasználtuk a Ramsey-féle RESET-tesztet és a CR-plotokat. Ezek alapján pedig a jelenlegi modellünk nemlineáris, amely miatt az életkor változót alakítjuk át. Először az életkor átalakításával próbálkoztunk: 1. 35-nél megtörő CR-plot miatt annak bevétele a modellbe 2. ötvenfelett dummy létrehozása Mivel az első módszer sikerre vezetett, a másodikat nem próbáltuk meg. #Linearitás tesztelése megmutatja, hogy még nem lineáris a modell resettest(logit2, type=&quot;regressor&quot;) RESET test data: logit2 RESET = 22.451, df1 = 6, df2 = 5250, p-value &lt; 2.2e-16 crPlots(logit2) crPlots(logit2, ~age) #Az életkor változó nagyjából 35 évnél törik meg, ezt kell belevennünk a modellbe logit3 &lt;- glm(died~age+sex+chronic_disease_binary+country_alt+pmax(age-35,0), data=data_Asia, family=binomial(logit)) summary(logit3) Call: glm(formula = died ~ age + sex + chronic_disease_binary + country_alt + pmax(age - 35, 0), family = binomial(logit), data = data_Asia) Deviance Residuals: Min 1Q Median 3Q Max -2.34145 -0.63063 -0.37089 -0.00011 2.82050 Coefficients: Estimate Std. Error z value Pr(&gt;|z|) (Intercept) -2.58076 0.53148 -4.856 1.20e-06 *** age 0.03218 0.01329 2.421 0.01547 * sexTRUE 0.47988 0.07761 6.183 6.28e-10 *** chronic_disease_binaryTRUE 2.13050 0.32237 6.609 3.88e-11 *** country_altJapan -16.72685 1967.29686 -0.009 0.99322 country_altMalaysia -17.54875 1417.57052 -0.012 0.99012 country_altNepal -16.49485 2797.44196 -0.006 0.99530 country_altPhilippines -1.37796 0.33313 -4.136 3.53e-05 *** country_altSingapore -17.36252 335.74122 -0.052 0.95876 country_altSouth Korea -16.67985 837.13291 -0.020 0.98410 country_altThailand -17.81103 2797.44196 -0.006 0.99492 country_altVietnam -18.97497 575.60639 -0.033 0.97370 pmax(age - 35, 0) 0.04405 0.01491 2.955 0.00313 ** --- Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 (Dispersion parameter for binomial family taken to be 1) Null deviance: 5835.2 on 5267 degrees of freedom Residual deviance: 4340.9 on 5255 degrees of freedom AIC: 4366.9 Number of Fisher Scoring iterations: 16 resettest(logit3, type=&quot;regressor&quot;) RESET test data: logit3 RESET = 0.44526, df1 = 8, df2 = 5247, p-value = 0.8943 crPlots(logit3) linearHypothesis(logit3, c(&quot;country_altJapan=0&quot;, &quot;country_altMalaysia=0&quot;, &quot;country_altNepal=0&quot;, &quot;country_altVietnam=0&quot;, &quot;country_altSingapore=0&quot;, &quot;country_altSouth Korea=0&quot;, &quot;country_altThailand=0&quot;)) Linear hypothesis test Hypothesis: country_altJapan = 0 country_altMalaysia = 0 country_altNepal = 0 country_altVietnam = 0 country_altSingapore = 0 country_altSouth Korea = 0 country_altThailand = 0 Model 1: restricted model Model 2: died ~ age + sex + chronic_disease_binary + country_alt + pmax(age - 35, 0) Res.Df Df Chisq Pr(&gt;Chisq) 1 5262 2 5255 7 0.0045 1 data_Asia$fulopindia &lt;- as.logical(data_Asia$country_alt==&quot;Philippines&quot;) Ezután a nem szignifikáns változók közül az országokat látjuk csak, így ezek összevont elhagyását teszteljük, a Fülöp-szk. és Indiát kivéve. Mivel a tesztnél p&gt;0,05, így ezeket a változót kidobhatjuk, az új dummyval pedig elkészült a modellünk. Az új modellben viszont az életkor változó átalakított formájában magas VIF-et okoz, így az eredeti életkort - amely a kevésbé szignifikáns változó - kihagyjuk a modellből. logit4 &lt;- glm(died~age+sex+chronic_disease_binary+fulopindia+I(pmax(age-35,0)), data=data_Asia, family=binomial(logit)) summary(logit4) Call: glm(formula = died ~ age + sex + chronic_disease_binary + fulopindia + I(pmax(age - 35, 0)), family = binomial(logit), data = data_Asia) Deviance Residuals: Min 1Q Median 3Q Max -2.3283 -0.6371 -0.3751 -0.2097 2.8072 Coefficients: Estimate Std. Error z value Pr(&gt;|z|) (Intercept) -4.56944 0.47649 -9.590 &lt; 2e-16 *** age 0.03081 0.01328 2.319 0.02039 * sexTRUE 0.46982 0.07694 6.107 1.02e-09 *** chronic_disease_binaryTRUE 2.09148 0.29034 7.203 5.87e-13 *** fulopindiaTRUE 0.64892 0.21725 2.987 0.00282 ** I(pmax(age - 35, 0)) 0.04610 0.01490 3.095 0.00197 ** --- Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 (Dispersion parameter for binomial family taken to be 1) Null deviance: 5835.2 on 5267 degrees of freedom Residual deviance: 4428.9 on 5262 degrees of freedom AIC: 4440.9 Number of Fisher Scoring iterations: 5 resettest(logit4, type=&quot;regressor&quot;) RESET test data: logit4 RESET = 0.41565, df1 = 10, df2 = 5252, p-value = 0.9399 vif(logit4) age sexTRUE 13.751477 1.008184 chronic_disease_binaryTRUE fulopindiaTRUE 1.057303 1.020537 I(pmax(age - 35, 0)) 13.803814 linearHypothesis(logit4, &quot;age&quot;) Linear hypothesis test Hypothesis: age = 0 Model 1: restricted model Model 2: died ~ age + sex + chronic_disease_binary + fulopindia + I(pmax(age - 35, 0)) Res.Df Df Chisq Pr(&gt;Chisq) 1 5263 2 5262 1 5.3783 0.02039 * --- Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 logit_final &lt;- glm(died~sex+chronic_disease_binary+fulopindia+I(pmax(age-35,0)), data=data_Asia, family=binomial(logit)) summary(logit_final) Call: glm(formula = died ~ sex + chronic_disease_binary + fulopindia + I(pmax(age - 35, 0)), family = binomial(logit), data = data_Asia) Deviance Residuals: Min 1Q Median 3Q Max -2.3423 -0.6262 -0.4012 -0.2523 2.4918 Coefficients: Estimate Std. Error z value Pr(&gt;|z|) (Intercept) -3.614952 0.227491 -15.891 &lt; 2e-16 *** sexTRUE 0.475936 0.077004 6.181 6.38e-10 *** chronic_disease_binaryTRUE 2.097687 0.291009 7.208 5.66e-13 *** fulopindiaTRUE 0.659963 0.217446 3.035 0.0024 ** I(pmax(age - 35, 0)) 0.080474 0.002715 29.641 &lt; 2e-16 *** --- Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 (Dispersion parameter for binomial family taken to be 1) Null deviance: 5835.2 on 5267 degrees of freedom Residual deviance: 4435.0 on 5263 degrees of freedom AIC: 4445 Number of Fisher Scoring iterations: 5 vif(logit_final) sexTRUE chronic_disease_binaryTRUE 1.007962 1.056893 fulopindiaTRUE I(pmax(age - 35, 0)) 1.017931 1.044902 resettest(logit_final, type=&quot;regressor&quot;) RESET test data: logit_final RESET = 0.31875, df1 = 8, df2 = 5255, p-value = 0.9593 #Az együtthatók jelentése exp(coef(logit_final)) (Intercept) sexTRUE 0.02691822 1.60952006 chronic_disease_binaryTRUE fulopindiaTRUE 8.14730002 1.93472091 I(pmax(age - 35, 0)) 1.08380014 plotmo(logit_final) plotmo grid: sex chronic_disease_binary fulopindia age TRUE FALSE TRUE 46 Az átalakított modellünk megfelel minden feltevésnek és tesztnek, így ennek együtthatóit értelmezhetjük: -cet. par. a férfi lét 1,61-szeresére növeli a halálozás oddsának értékét -cet. par. a krónikus betegség megléte 8,15-szeresére növeli a halálozás oddsának értékét -cet. par. a Fülöp-szk-n vagy Indiában való állampolgárság 1,95-szeresére növeli a halálozás oddsának értékét -cet. par. a 35 évnél idősebb embereknek 1,08-szor nagyobb a halálozás oddsának értéke Előrejelzés a kiválasztott modellel deathval &lt;- predict(logit_final, data_Asia, type=&quot;response&quot;) data_Asia$deathval &lt;- deathval data_Asia$becsult &lt;- ifelse(deathval&gt;0.5, &quot;TRUE&quot;, &quot;FALSE&quot;) xtabs(~died+becsult, data=data_Asia) becsult died FALSE TRUE FALSE 3674 317 TRUE 766 511 fin_perc &lt;- sum(data_Asia$died==data_Asia$becsult)/nrow(data_Asia)*100 A próba 50%-os cutoff értéknél a modell 79.4419134%-ban helyes eredményt ad. Az ROC-görbe GINI-mutatója 0.6554136. A modellünk kalibrálása során a másodfajú hiba súlya 3, így a simított költségfüggvény alapján a 0.2960607 lesz az optimális küszöbérték. becsult_final died FALSE TRUE FALSE 3197 794 TRUE 405 872 Az optimális küszöbértéknél a klasszifikáció pontossága 77.2399393% lesz. "],
["Chapter-4.html", "Szövegelemzés Elemzés", " Szövegelemzés p { text-align: justify; } Elemzés A koronavírus eseményei és a vele kapcsolatos hírek megmutatják, hogy az emberek és a különböző médiumok hogyan viszonyulnak a pandémiához az idő elteltével. Ezen elemzéshez a Guardian napilap COVID-19-el kapcsolatos címeit gyűjtöttük össze. A körülbelül egy év szalagcímeit felölelő korpuszon bag of Words módszerrel a havonta és az egy év során leggyakoribb szavakat kerestük meg, sentiment analízissel pedig az AFINN szótár érzelmi skálája segítségével elemeztük a napi hírek korpuszait. nr_of_pages=528 #528 lapig lehetett visszamenni a keresésben for (i in 1:nr_of_pages) { URL &lt;- paste(&quot;https://www.theguardian.com/world/coronavirus-outbreak+uk/uk?page=&quot;, i, sep = &quot;&quot;) page &lt;- read_html(URL) title &lt;- html_text(html_nodes(page, &quot;.js-headline-text&quot;)) #Van olyan hogy egy lapon két dátum is szerepel, heti bontás miatt ez nem probléma time &lt;- html_text(html_nodes(page, &quot;.fc-date-headline&quot;))[1] if (i==1){ data_raw &lt;- data.frame(time, title) } else{ data_raw &lt;- rbind(data_raw, data.frame(time, title)) } } Error in open.connection(x, &quot;rb&quot;): Timeout was reached: [www.theguardian.com] Connection timed out after 10004 milliseconds A Guardian honlapján a COVID keresőszóra nagyjából január 29-től kezdődően nagyjából 1.05610^{4} cikk címet találtunk data_cleansed &lt;- data_raw %&gt;% filter(!duplicated(title)) %&gt;% {mutate(., id = seq(nrow(.)))} %&gt;% mutate( date = as.Date(time, format = &quot;%d %B %Y&quot;), month = format(date, &quot;%Y-%m&quot;) ) %&gt;% na.omit() Bag of Words corpus_raw &lt;- Corpus(VectorSource(as.character(data_cleansed$title))) #Korpusz tisztítása corpus_filtered &lt;- corpus_raw %&gt;% tm_map(content_transformer(tolower)) %&gt;% tm_map(stripWhitespace) %&gt;% tm_map(removeNumbers) %&gt;% tm_map(removePunctuation, ucp=TRUE) %&gt;% tm_map(removeWords, c(stopwords(&quot;english&quot;), &quot;also&quot;, &quot;one&quot;, &quot;will&quot;)) A korpusz szokásos tisztítása közben voltak olyan stopwordok, amelyeket mi adtunk hozzá, majd a strukturált mátrix és a fogalmak eloszlását vizsgáltuk a teljes korpuszban termdocument &lt;- removeSparseTerms(TermDocumentMatrix(corpus_filtered), 0.999) documentterm &lt;- removeSparseTerms(DocumentTermMatrix(corpus_filtered), 0.999) words_frequency_all &lt;- data.frame(Words=row.names(as.matrix(termdocument)), Freq=rowSums(as.matrix(termdocument), na.rm = TRUE)) freqterms &lt;- findFreqTerms(documentterm, lowfreq = 100) ggwordcloud(words_frequency_all$Words, words_frequency_all$Freq, max.words = 100) A havonta leggyakoribb szavakat vizsgáltuk egy ciklusban, amely a havi korpuszokat megtisztítja és elemzi data_cleansed_monthly &lt;- data_cleansed %&gt;% group_by(month) %&gt;% summarise(monthly_text = paste(title, collapse = &quot; &quot;)) #Táblázat létrehozása words_monthly &lt;- data.frame(matrix(ncol=nrow(data_cleansed_monthly), nrow=15)) colnames(words_monthly) &lt;- data_cleansed_monthly$month for (i in 1:nrow(data_cleansed_monthly)){ #Corpus létrehozása corpus_monthly_raw &lt;- Corpus(VectorSource(as.character(data_cleansed_monthly$monthly_text[i]))) #Korpusz tisztítása corpus_monthly_filtered &lt;- corpus_monthly_raw %&gt;% tm_map(content_transformer(tolower)) %&gt;% tm_map(removePunctuation, ucp=TRUE) %&gt;% tm_map(removeNumbers) %&gt;% tm_map(removeWords, c(stopwords(&quot;english&quot;), &quot;also&quot;, &quot;one&quot;, &quot;will&quot;)) #%&gt;% tm_map(stemDocument) #Term-Document mátrix létrehozása a 10 leggyakoribb szó miatt matrix_monthly &lt;- removeSparseTerms(TermDocumentMatrix(corpus_monthly_filtered), 0.999) words_frequency &lt;- data.frame(Words = matrix_monthly$dimnames$Terms, Freq = matrix_monthly$v) words_monthly[,data_cleansed_monthly$month[i]]&lt;- head(words_frequency[order(-words_frequency$Freq),]$Words,15) #Szófelhők készítése, a corpus nagyságától függően plot(ggwordcloud(words_frequency$Words, words_frequency$Freq, max.words = 100)+ ggtitle(data_cleansed_monthly$month[i])) #wordcloud(corpus_monthly_filtered, max.words=0.1*matrix_monthly$nrow) } A havonta 15 leggyakoribb szó a Guardian címeiben. Színekkel a teljes korpusz leggyakoribb szavait jelöltük A táblázatból az alábbi információk olvashatóak le: -a január-februári időszakban az Egyesült Királysággal még kevésbé foglalkoztak a cikkek -a következő időszakban Nagy-Britannia miniszterelnöke és az ott bevezetett tier alapú módszer külcsszavai is előkerültek -a karácsonyi lezárások már novemberben is közbeszéd alapja voltak -a kezdeti ‘coronavirus’ kifejezésről fokozatosan állt át a Guardian az egyszerűbb, COVID betűszóra Sentiment elemzés A sentiment elemzésben a napi címekből, az AFINN szótár érzelmi skálájának felhasználásával készült A grafikonokon pedig az érzelmet tartalmazó szavak számát és a napi átlagokat ábrázoltuk #AFINN lexikon betöltése AFINN &lt;- get_sentiments(&quot;afinn&quot;) data_cleansed &lt;- data_cleansed %&gt;% mutate( title = as.character(title) ) #Szavakra bontás, pontszámok összeaggregálása words &lt;- left_join( tidytext::unnest_tokens(data_cleansed, words, title), AFINN, by=c(&quot;words&quot;=&quot;word&quot;)) nr_sentiment_words &lt;- words %&gt;% group_by(date) %&gt;% summarise(non_na_count = sum(!is.na(value))) score_by_id &lt;- words %&gt;% group_by(id) %&gt;% summarize(score=sum(value, na.rm=TRUE)) #Eredeti adatok mellé rakás data_cleansed &lt;- left_join(data_cleansed, score_by_id, by=&quot;id&quot;) #Napi (és heti) aggregálás score_by_day &lt;- data_cleansed %&gt;% group_by(date) %&gt;% summarize(score_sum=sum(score, na.rm=TRUE), score_avg=mean(score, na.rm=TRUE)) Grafikonok deaths_in_uk &lt;- read_csv(&quot;data_2020-Dec-29.csv&quot;, col_types = cols_only(date = col_guess(), newDeaths28DaysByDeathDate = col_guess())) nr_sentiment_words &lt;- merge(nr_sentiment_words, deaths_in_uk, by=&quot;date&quot;) coeff=10 ggplot(nr_sentiment_words, aes(x=date)) + geom_line(aes(y=non_na_count), size=.5, color=&quot;#0fad04&quot;)+ geom_bar(aes(y = newDeaths28DaysByDeathDate/coeff), stat=&quot;identity&quot;, size=.1, fill=&quot;steelblue&quot;, alpha=.4) + geom_smooth(aes(y=non_na_count), method=&quot;loess&quot;, colour=&quot;#0fad04&quot;, alpha=0.2) + geom_hline(yintercept=0, color=&quot;black&quot;, size=.75) + xlab(&quot;Dátum&quot;) + scale_x_date(date_breaks = &quot;1 month&quot;, date_labels = &quot;%Y %m&quot;) + scale_y_continuous( name = &quot;Érzelmi szavak száma naponta&quot;, sec.axis = sec_axis(~.*coeff, name=&quot;Napi halálozások száma&quot;) ) ggplot(score_by_day, aes(x=date)) + geom_line( aes(y=score_avg), color=&quot;#0fad04&quot;) + geom_smooth(aes(y=score_avg), method=&quot;loess&quot;, colour=&quot;#0fad04&quot;, alpha=0.2) + geom_hline(yintercept=0, color=&quot;black&quot;, size=.75) + xlab(&quot;Dátum&quot;) + ylab(&quot;Átlagos napi érzelmi pontszám&quot;) + scale_x_date(date_breaks = &quot;1 month&quot;, date_labels = &quot;%Y %m&quot;) + ylim(-2.5, 2.5) A grafikonokról el lehet mondani, hogy az érzelemmel töltött szavak száma áprilisban tetőzött. A brit kormány ekkor kezdte el bevezetni a szigorúbb intézkedéseit, Európában az egyik legutolsóként, a halottak száma pedig . Ez a tény pedig az erősen liberális Guardian lapnál valószínűleg erős érzelmeket válthatott ki. Az átlagos érzelmi töltet ugyanakkor viszonylag stabilan növekedik, amely a vakcina megjelenésének és az emberek vírushoz való hozzászokásának lehet köszönhető. "],
["Chapter-5.html", "Idősor elemzés SARIMA", " Idősor elemzés p { text-align: justify; } A következőkben sztochasztikus idősorelemzési eljárással modellezzük a magyar COVID-19 megbetegedés számot. Az adatok az Our World in Data4 weboldalról származnak, napi új regisztrálásokat és haláleseteket tartalmaznak. dat &lt;- readxl::read_excel(&#39;COVID-19-geographic-disbtribution-worldwide.xlsx&#39;) dat %&gt;% head %&gt;% gt %&gt;% tab_header(title = &#39;A letöltött adattábla&#39;) html { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif; } #pvbvbxrrft .gt_table { display: table; border-collapse: collapse; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; } #pvbvbxrrft .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; } #pvbvbxrrft .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; border-bottom-color: #FFFFFF; border-bottom-width: 0; } #pvbvbxrrft .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 0; padding-bottom: 4px; border-top-color: #FFFFFF; border-top-width: 0; } #pvbvbxrrft .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; } #pvbvbxrrft .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; } #pvbvbxrrft .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; } #pvbvbxrrft .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; } #pvbvbxrrft .gt_column_spanner_outer:first-child { padding-left: 0; } #pvbvbxrrft .gt_column_spanner_outer:last-child { padding-right: 0; } #pvbvbxrrft .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; overflow-x: hidden; display: inline-block; width: 100%; } #pvbvbxrrft .gt_group_heading { padding: 8px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; } #pvbvbxrrft .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: middle; } #pvbvbxrrft .gt_from_md > :first-child { margin-top: 0; } #pvbvbxrrft .gt_from_md > :last-child { margin-bottom: 0; } #pvbvbxrrft .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; } #pvbvbxrrft .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 12px; } #pvbvbxrrft .gt_summary_row { color: #333333; background-color: #FFFFFF; text-transform: inherit; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; } #pvbvbxrrft .gt_first_summary_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; } #pvbvbxrrft .gt_grand_summary_row { color: #333333; background-color: #FFFFFF; text-transform: inherit; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; } #pvbvbxrrft .gt_first_grand_summary_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; border-top-style: double; border-top-width: 6px; border-top-color: #D3D3D3; } #pvbvbxrrft .gt_striped { background-color: rgba(128, 128, 128, 0.05); } #pvbvbxrrft .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; } #pvbvbxrrft .gt_footnotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; } #pvbvbxrrft .gt_footnote { margin: 0px; font-size: 90%; padding: 4px; } #pvbvbxrrft .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; } #pvbvbxrrft .gt_sourcenote { font-size: 90%; padding: 4px; } #pvbvbxrrft .gt_left { text-align: left; } #pvbvbxrrft .gt_center { text-align: center; } #pvbvbxrrft .gt_right { text-align: right; font-variant-numeric: tabular-nums; } #pvbvbxrrft .gt_font_normal { font-weight: normal; } #pvbvbxrrft .gt_font_bold { font-weight: bold; } #pvbvbxrrft .gt_font_italic { font-style: italic; } #pvbvbxrrft .gt_super { font-size: 65%; } #pvbvbxrrft .gt_footnote_marks { font-style: italic; font-size: 65%; } A letöltött adattábla dateRep day month year cases deaths countriesAndTerritories geoId countryterritoryCode popData2019 continentExp Cumulative_number_for_14_days_of_COVID-19_cases_per_100000 2020-12-14 14 12 2020 746 6 Afghanistan AF AFG 38041757 Asia 9.013779 2020-12-13 13 12 2020 298 9 Afghanistan AF AFG 38041757 Asia 7.052776 2020-12-12 12 12 2020 113 11 Afghanistan AF AFG 38041757 Asia 6.868768 2020-12-11 11 12 2020 63 10 Afghanistan AF AFG 38041757 Asia 7.134266 2020-12-10 10 12 2020 202 16 Afghanistan AF AFG 38041757 Asia 6.968658 2020-12-09 9 12 2020 135 13 Afghanistan AF AFG 38041757 Asia 6.963401 dat %&gt;% filter(countryterritoryCode == &#39;HUN&#39;) %&gt;% arrange(dateRep) %&gt;% ggplot + geom_line(aes(dateRep, cases)) + labs(x = NULL, y = &#39;Új megfertőzdések&#39;, title = &quot;Megfertőződések számának alakulása Magyarországon&quot;) Érdemes strutúrális törésnek tekinteni 2020 szeptemberét, inntől jelentősen emelkednek az esetszámok. Mivel látszik, hogy nem stacioner a napi új esetek száma, így annak transzformációit is érdemes megvizsgálni (diff, log). dat %&gt;% filter(countryterritoryCode == &#39;HUN&#39;, dateRep &gt; lubridate::ymd(&#39;2020-09-01&#39;)) %&gt;% arrange(dateRep) %&gt;% select(dateRep, cases) %&gt;% mutate( diff = c(NA, diff(cases)), log = log(cases) ) %T&gt;% {print(apply(select(., diff, log), 2, function(x) forecast::ndiffs(na.omit(x)) == 0 ))} %&gt;% select(-cases) %&gt;% pivot_longer(-1) %&gt;% ggplot + geom_line(aes(dateRep, value)) + facet_wrap(~name, ncol = 1, scales = &#39;free_y&#39;) + labs(title = &#39;A magyar esetszámok idősorának transzformációi&#39;, x = NULL, y = NULL) diff log TRUE FALSE Mivel az esetszámok differenciázottja stacioner, így azon folytatjuk a Box-jenkins modellezést. dat %&gt;% filter(countryterritoryCode == &#39;HUN&#39;, dateRep &gt; lubridate::ymd(&#39;2020-09-01&#39;)) %&gt;% arrange(dateRep) %&gt;% pull(cases) %&gt;% ts %&gt;% forecast::auto.arima() %T&gt;% {tab_header(gt(broom::tidy(.)), &#39;ARIMA(0,1,2) modell&#39;)} %&gt;% forecast::checkresiduals() Ljung-Box test data: Residuals from ARIMA(0,1,2) with drift Q* = 17.63, df = 7, p-value = 0.01376 Model df: 3. Total lags used: 10 A Ljung-Box teszt alapján elutasítjuk a nullhipotézist, miszerint a maradéktag fehérzaj folyamat lenne. A maradéktagot ACF-jéből látjuk, hogy a 7. késleltetés az, amely statisztikailag szignifikáns és ez elméleti megfontolásból is megállja a helyét (Hétvégén kevesebbet mennek el az emberek teszetlni, mert inkább otthon maradnak megpróbálni kipihenni). dat %&gt;% filter(countryterritoryCode == &#39;HUN&#39;, dateRep &gt;= lubridate::ymd(&#39;2020-09-01&#39;)) %&gt;% arrange(dateRep) %&gt;% pull(cases) %&gt;% ts(frequency = 7) %&gt;% forecast::ggmonthplot() + labs(x = NULL, y = &#39;Napi esetszám&#39;, title = &#39;Esetszámok hét napjai szerint lebontva&#39;) dat %&gt;% filter(countryterritoryCode == &#39;HUN&#39;, dateRep &gt;= lubridate::ymd(&#39;2020-09-01&#39;)) %&gt;% arrange(dateRep) %&gt;% mutate(day = weekdays(dateRep)) %&gt;% lm(formula = cases ~ day) %&gt;% .$resid %&gt;% ts %&gt;% forecast::auto.arima() %&gt;% {mod &lt;&lt;- .} broom::tidy(mod) %&gt;% gt %&gt;% tab_header(&#39;Heti szezonalitással szűrt ARIMA(0,1,2) modell paraméterei&#39;) html { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif; } #lceukrtwhm .gt_table { display: table; border-collapse: collapse; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; } #lceukrtwhm .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; } #lceukrtwhm .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; border-bottom-color: #FFFFFF; border-bottom-width: 0; } #lceukrtwhm .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 0; padding-bottom: 4px; border-top-color: #FFFFFF; border-top-width: 0; } #lceukrtwhm .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; } #lceukrtwhm .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; } #lceukrtwhm .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; } #lceukrtwhm .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; } #lceukrtwhm .gt_column_spanner_outer:first-child { padding-left: 0; } #lceukrtwhm .gt_column_spanner_outer:last-child { padding-right: 0; } #lceukrtwhm .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; overflow-x: hidden; display: inline-block; width: 100%; } #lceukrtwhm .gt_group_heading { padding: 8px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; } #lceukrtwhm .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: middle; } #lceukrtwhm .gt_from_md > :first-child { margin-top: 0; } #lceukrtwhm .gt_from_md > :last-child { margin-bottom: 0; } #lceukrtwhm .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; } #lceukrtwhm .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 12px; } #lceukrtwhm .gt_summary_row { color: #333333; background-color: #FFFFFF; text-transform: inherit; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; } #lceukrtwhm .gt_first_summary_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; } #lceukrtwhm .gt_grand_summary_row { color: #333333; background-color: #FFFFFF; text-transform: inherit; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; } #lceukrtwhm .gt_first_grand_summary_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; border-top-style: double; border-top-width: 6px; border-top-color: #D3D3D3; } #lceukrtwhm .gt_striped { background-color: rgba(128, 128, 128, 0.05); } #lceukrtwhm .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; } #lceukrtwhm .gt_footnotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; } #lceukrtwhm .gt_footnote { margin: 0px; font-size: 90%; padding: 4px; } #lceukrtwhm .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; } #lceukrtwhm .gt_sourcenote { font-size: 90%; padding: 4px; } #lceukrtwhm .gt_left { text-align: left; } #lceukrtwhm .gt_center { text-align: center; } #lceukrtwhm .gt_right { text-align: right; font-variant-numeric: tabular-nums; } #lceukrtwhm .gt_font_normal { font-weight: normal; } #lceukrtwhm .gt_font_bold { font-weight: bold; } #lceukrtwhm .gt_font_italic { font-style: italic; } #lceukrtwhm .gt_super { font-size: 65%; } #lceukrtwhm .gt_footnote_marks { font-style: italic; font-size: 65%; } Heti szezonalitással szűrt ARIMA(0,1,2) modell paraméterei term estimate std.error ma1 -0.2319610 0.09318890 ma2 -0.4137085 0.09259579 drift 38.5799908 23.28876815 mod %&gt;% forecast::checkresiduals() Ljung-Box test data: Residuals from ARIMA(0,1,2) with drift Q* = 11.929, df = 7, p-value = 0.1029 Model df: 3. Total lags used: 10 SARIMA dat %&gt;% filter(countryterritoryCode == &#39;HUN&#39;, dateRep &gt;= lubridate::ymd(&#39;2020-09-01&#39;)) %&gt;% arrange(dateRep) %&gt;% pull(cases) %&gt;% ts(frequency = 7) %&gt;% forecast::auto.arima() %T&gt;% {m.sarima &lt;&lt;- .} %&gt;% forecast::checkresiduals() Ljung-Box test data: Residuals from ARIMA(0,1,2)(0,0,2)[7] Q* = 9.397, df = 10, p-value = 0.4949 Model df: 4. Total lags used: 14 Szezonális ARIMA modellt alkalmazva lényegesen nagyobb p-értéket kaptunk a modell hibatagjain elvégzett Ljung-box teszthet. m.sarima %&gt;% broom::tidy() %&gt;% gt %&gt;% tab_header(title = &#39;Illesztett SARIMA modell paraméterei&#39;) html { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif; } #itwpyoczct .gt_table { display: table; border-collapse: collapse; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; } #itwpyoczct .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; } #itwpyoczct .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; border-bottom-color: #FFFFFF; border-bottom-width: 0; } #itwpyoczct .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 0; padding-bottom: 4px; border-top-color: #FFFFFF; border-top-width: 0; } #itwpyoczct .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; } #itwpyoczct .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; } #itwpyoczct .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; } #itwpyoczct .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; } #itwpyoczct .gt_column_spanner_outer:first-child { padding-left: 0; } #itwpyoczct .gt_column_spanner_outer:last-child { padding-right: 0; } #itwpyoczct .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; overflow-x: hidden; display: inline-block; width: 100%; } #itwpyoczct .gt_group_heading { padding: 8px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; } #itwpyoczct .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: middle; } #itwpyoczct .gt_from_md > :first-child { margin-top: 0; } #itwpyoczct .gt_from_md > :last-child { margin-bottom: 0; } #itwpyoczct .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; } #itwpyoczct .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 12px; } #itwpyoczct .gt_summary_row { color: #333333; background-color: #FFFFFF; text-transform: inherit; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; } #itwpyoczct .gt_first_summary_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; } #itwpyoczct .gt_grand_summary_row { color: #333333; background-color: #FFFFFF; text-transform: inherit; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; } #itwpyoczct .gt_first_grand_summary_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; border-top-style: double; border-top-width: 6px; border-top-color: #D3D3D3; } #itwpyoczct .gt_striped { background-color: rgba(128, 128, 128, 0.05); } #itwpyoczct .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; } #itwpyoczct .gt_footnotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; } #itwpyoczct .gt_footnote { margin: 0px; font-size: 90%; padding: 4px; } #itwpyoczct .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; } #itwpyoczct .gt_sourcenote { font-size: 90%; padding: 4px; } #itwpyoczct .gt_left { text-align: left; } #itwpyoczct .gt_center { text-align: center; } #itwpyoczct .gt_right { text-align: right; font-variant-numeric: tabular-nums; } #itwpyoczct .gt_font_normal { font-weight: normal; } #itwpyoczct .gt_font_bold { font-weight: bold; } #itwpyoczct .gt_font_italic { font-style: italic; } #itwpyoczct .gt_super { font-size: 65%; } #itwpyoczct .gt_footnote_marks { font-style: italic; font-size: 65%; } Illesztett SARIMA modell paraméterei term estimate std.error ma1 -0.2611314 0.09140709 ma2 -0.3684478 0.09375723 sma1 0.4138886 0.10226211 sma2 0.2088278 0.10980747 ggpubr::ggarrange( forecast::forecast(mod) %&gt;% forecast::autoplot(showgap = F), forecast::forecast(m.sarima) %&gt;% forecast::autoplot(showgap = F), nrow = 2 ) https://ourworldindata.org/coronavirus-source-data↩︎ "],
["Chapter-6.html", "Klaszterezés és főkomponens elemzés Klaszterezés Főkomponens elemzés", " Klaszterezés és főkomponens elemzés Az országok klaszterezése és a trendek megállapítása fontos feladat, hiszen a vírus lefutása földrajzilag változó a különböző területeken. Ezen kívül az alábbi elemzés célja az is, hogy egy-egy országegy főre jutó GDP és az egészségügyi kiadások GDP arányos értékével próbálja magyarázni a halálozási rátát. Ennek intuíciója, hogy a gazdagabb és egészségügyre többet költp országok jobban fel lehettek készülve egy esetleges járványra. country_data_merge &lt;- left_join(country_data, healthcare, by=c(&quot;countrycode&quot;=&quot;Country Code&quot;)) country_data_merge &lt;- left_join(country_data_merge, gdp_per_cap, by=c(&quot;countrycode&quot;=&quot;Country Code&quot;)) country_data_merge &lt;- left_join(country_data_merge, population, by=c(&quot;countrycode&quot;=&quot;Country Code&quot;)) #Mindegyik adatot népességarányosan számoltunk country_data_merge[, c(2:8, 12:13)] &lt;- country_data_merge[ , c(2:8,12:13)]/country_data_merge$Population*100000 #A 15 legnépesebb és leggazdagabb országot fogjuk plotolni, az átláhatóság kedvéért biggest_countries &lt;- unique(c(head(country_data_merge[order(-country_data_merge$Population),]$`Country/Region`,15), head(country_data_merge[order(-country_data_merge$GDPperCapita),]$`Country/Region`,15))) Adattáblánkban keresztmetszeti adatokat használtunk, július 27-i dátummal 165 országból. Az ekkori 100 000 főre vetített esetek, halálozások, aktív esetek és az egy héttel korábbi változás látható. country_data_merge[,c(&quot;countrycode&quot;,&quot;WHO Region&quot;, &quot;Country/Region&quot;)] &lt;- NULL country_data_merge$`Deaths / 100 Recovered` &lt;- replace(country_data_merge$`Deaths / 100 Recovered`, is.infinite(country_data_merge$`Deaths / 100 Recovered`),NA) rownames(country_data_merge) &lt;- country_data$`Country/Region` datatable(country_data_merge %&gt;% mutate_if(is.numeric, ~round(., 1)), rownames=TRUE, filter = &quot;none&quot;, options = list(pageLength=15, scrollX=&#39;400px&#39;, scrollY=&#39;400px&#39;, dom=&#39;ltp&#39;), fillContainer = TRUE) %&gt;% formatStyle(names(head(country_data_merge, 15)), font=&quot;bold&quot;, fontSize = &#39;9.5pt&#39;) Ezeket az adatokat a főkomponens elemzéshez és a klaszterezéshez le kell normáljuk. country_data_filter &lt;- data.frame(scale(dplyr::select_if(country_data_merge, is.numeric)), check.names = FALSE) rownames(country_data_filter) &lt;- country_data$`Country/Region` Klaszterezés A hierarchikus klaszterezésből látszódik, hogy a gazdagabb (high-income) országok alkotnak egy nagyobb csoportot, míg a szegényebb (low income) országok is egy csoportba tartoznak. library(igraph) hier &lt;- hclust(dist(country_data_filter), method=&quot;ward.D&quot;) plot(hier) library(factoextra) fviz_dend(hier, k=4, repel=TRUE, select.ind = list(name=biggest_countries), type=&quot;rectangle&quot;) Elsősorban 4 különböző csoportra osztottuk az országokat, azonban a Gap-statisztika maximalizálásakor a k=3 klaszter lett az optimális. Ekkor pedig ennyi klaszterrel k-közép klaszterezést hajtottunk végre, azonban mindössze 3 változót felhasználva: -100 esetre jutó halálozások száma -egészségügyi kiadások aránya -GDP per fő Ezt olyan megfontolásból, hogy elsősorban az utóbbi két változó a halálozási arányra nyújthat magyarázatot, így ezzel akartuk párba állítani. Továbbá az optimális klaszterek száma divergált akkor, hogyha az összes változót felhasználnánk. set.seed(42) country_data_filter_na &lt;- na.omit(country_data_filter) fviz_nbclust(country_data_filter_na[,c(&quot;Deaths / 100 Cases&quot;, &quot;HealthExpperGDP&quot;, &quot;GDPperCapita&quot;)], FUNcluster=kmeans, method=&quot;gap_stat&quot;) kkozep &lt;- kmeans(country_data_filter_na[,c(&quot;Deaths / 100 Cases&quot;, &quot;HealthExpperGDP&quot;, &quot;GDPperCapita&quot;)], centers=3, nstart=100, iter.max=100) kkozep$centers Deaths / 100 Cases HealthExpperGDP GDPperCapita 1 -0.39022271 -0.8793173 -0.3866760 2 1.00336778 1.1636760 1.9957319 3 -0.03975533 0.4357404 -0.2483867 country_data_filter_na$klaszter &lt;- as.factor(kkozep$cluster) levels(country_data_filter_na$klaszter) &lt;- c( &quot;Gazdag ország, magas halálozással&quot;, &quot;Magasabb egészségügyi kiadás&quot;, &quot;Alacsony egészségügyi kiadás&quot;) Főkomponens elemzés Ez következhet az adatok minőségéből, valamint abból, hogy ezekbe az országokba korábban ért el a vírus a globalizáció miatt, így az első hullám alatti halálesetekben még nem volt annyira felkészülve az egészségügy. (Az előzetes magas arányú költekezés ellenére.) fokomp &lt;- princomp(country_data_filter_na[ , 1:15]) fokomp %&gt;% summary() Importance of components: Comp.1 Comp.2 Comp.3 Comp.4 Comp.5 Standard deviation 2.4242839 1.4692307 1.4132999 1.06236800 0.95158166 Proportion of Variance 0.4026878 0.1479045 0.1368580 0.07733061 0.06204312 Cumulative Proportion 0.4026878 0.5505923 0.6874503 0.76478088 0.82682400 Comp.6 Comp.7 Comp.8 Comp.9 Comp.10 Standard deviation 0.81616357 0.73292048 0.6508623 0.60555793 0.46967173 Proportion of Variance 0.04564108 0.03680571 0.0290255 0.02512539 0.01511438 Cumulative Proportion 0.87246507 0.90927078 0.9382963 0.96342168 0.97853606 Comp.11 Comp.12 Comp.13 Comp.14 Comp.15 Standard deviation 0.39038422 0.330882505 0.226669757 1.299502e-08 0 Proportion of Variance 0.01044206 0.007501517 0.003520373 1.157058e-17 0 Cumulative Proportion 0.98897811 0.996479627 1.000000000 1.000000e+00 1 A főkomponens elemzéshez a COVID-járvány összes adatát felhasználtuk, és a loadingok alapján megállapíthattuk az intuícióval ellentétes következtetést, hogy a gazdagabb országoknak magasabb a halálozási arányuk. fokomp %&gt;% .$loadings %&gt;% unclass() %&gt;% data.frame() %&gt;% rownames_to_column() %&gt;% pivot_longer(-1) %&gt;% mutate( name = str_remove(name, &#39;Comp.&#39;), name = factor(str_c(&#39;# &#39;, name), levels = str_c(&#39;# &#39;, 1:n_distinct(name))) ) %&gt;% ggplot + aes(rowname, value, fill = value &lt; 0) + geom_hline(yintercept = 0) + geom_col(color = &#39;black&#39;) + coord_flip() + scale_fill_discrete(guide = F) + scale_y_continuous(labels = scales::percent) + facet_wrap(~name, ncol = 3) + labs(x = NULL, y = NULL, title = &#39;Főkomponensek&#39;) Az első főkomponens leginkább a vírus július 27-ével bezárólag átlagos szintjét határozza meg. A második főkomponens a halálozás arányát és a egészségügyi kiadások mértékét használja negatív előjellel, míg a gyógyultak számát pozitívval, így ennek a negatív szorzata mondható a halálozás mértékének. A harmadik főkomponensben az aktív és az új esetek, valamint az előző héthez képesti változás szerepelnek negatív előjellel, tehát ez a járvány lecsengését mutatja. country_data_filter_na &lt;- cbind(country_data_filter_na, fokomp$scores[ ,1:3]) country_data_filter_na$Comp.2 &lt;- -country_data_filter_na$Comp.2 colnames(country_data_filter_na)[18:20] &lt;- c(&quot;Vírus általános elterjedése&quot;, &quot;Halálozás aránya&quot;, &quot;Jelenleg javuló állapot&quot;) fviz_pca_biplot(fokomp, habillage=country_data_filter_na$klaszter, repel = TRUE, select.ind = list(name=biggest_countries), geom.var = c(&quot;arrow&quot;, &quot;text&quot;), title = &quot;Legnagyobb és leggazdagabb országok biplotja&quot;) "]
]
